/*
Flex tools: classes-helpers for more rapidly web-development.
Important! Works only at browsers that has Flexbox support
Table of content:
1. f-box: initial component and its states, which gives you the core flexbox power
2. f-col:  you can create grids with it
3. f-align: control direction of content inside box

*/

$flex-tools = {
  gaps: {
    S: .5 // 1
    M: 1  // 2
    L: 2  // 4
    XL: 4 // 8
  }
  aligns: {
    '1-1': flex-start flex-start
    '1-2': flex-start center
    '1-3': flex-start flex-end
                  
    '2-1': center flex-start
    '2-2': center center
    '2-3': center flex-end
                  
    '21-1': baseline flex-start
    '21-2': baseline center
    '21-3': baseline flex-end
                  
    '3-1': flex-end flex-start
    '3-2': flex-end center
    '3-3': flex-end flex-end
                  
    '1-13': flex-start space-between
    '2-13': center space-between
    '21-13': baseline space-between
    '3-13': flex-end space-between
                  
    '13-1': stretch flex-start
    '13-2': stretch center
    '13-3': stretch flex-end
    '13-13': stretch space-between
  }
  dirs: {
    'row': row
    'col': column
    'row-rvs': row-reverse
    'col-rvs': column-reverse
  }
}


-make-gap(mlt)
  gap = $global.grid.base-gap 
  margin-right: gap * mlt
  margin-left:  gap * mlt
    
make-gap(val)
  -make-gap (val / -2)  // negative 1/2 of gap to compensate positive f-grid gaps
  & > *
    -make-gap (val / 2)


get-gap(mlt)
  return $global.grid.base-gap * $flex-tools.gaps[mlt]


make-fill(safari-auto-basis = true)
  flex 1 0 0%
  max-width 100% //fix FF and IE content overflowing issue
  min-width: 0  //fix ellipsis bug inside flex containers at FF & Chorme 48+
  if safari-auto-basis
    .safari &
    .ios &
      flex-basis: auto

/*----------------------------
  Init classes
----------------------------*/
.f-box
  display flex
  
.f-line
  display inline-flex




/*----------------------------
  Filling
----------------------------*/

.f-fill    
  make-fill()

/*----------------------------
  Gap controllers
----------------------------*/
.f-gap
  
  
  for mod, mlt in $flex-tools.gaps
    &--{mod}
    &--{mod}-pseudo
      make-gap(mlt)
      
    &--{mod}-pseudo
      &:before
      &:after
        -make-gap(mlt / 2)
      

/*----------------------------
  Grid controllers
----------------------------*/
.f-grid  
  flex 0 1 auto  //reset for correctly working

  for num in 1..$global.grid.columns
    &--{num}
      width = (num / $global.grid.columns * 100%)
      flex-basis width
              
      for mod, mlt in $flex-tools.gaps
        .f-gap--{mod} > &
          flex-basis: s('calc(%s - (%s * %s))', width, $global.grid.base-gap, mlt)



/*----------------------------
  Align controllers
----------------------------*/

.f-align
  //    1-1       1-2       1-3
  //
  //
  //    2-1       2-2       2-3  - center
  //    21-1      21-2      21-3 - baseline
  //
  //
  //    3-1       3-2       3-3
  //
  //
  // 13 - from 1 to 3


  for name, aligns in $flex-tools.aligns
    &--{unquote(name)}
      align-items: aligns[0]
      justify-content: aligns[1]


/*----------------------------
  Self align controllers
----------------------------*/
.f-self-align
  $cases = '1'  flex-start
          ,'2'  center
          ,'21' baseline
          ,'3'  flex-end
          
  for $each in $cases
    &--{unquote($each[0])}
      align-self $each[1]

/*----------------------------
  Direction controllers
----------------------------*/
.f-dir
  for name, dir in $flex-tools.dirs
    &--{unquote(name)}
      flex-direction: dir


/*----------------------------
  Options
----------------------------*/
.f-option
  
  &--wrap
    flex-wrap wrap

  &--nogap
    margin-left  0
    margin-right 0

  &--nofill
    flex 0 1 auto

  
  &--safari-basis-fix
    .safari &
    .ios &
      flex-basis: auto

/*----------------------------
  Most used patterns
----------------------------*/
.f-pattern
  
  &--ctr-col
    @extend .f-box
    @extend .f-align--2-2
    @extend .f-dir--col

  &--full-fill
    @extend .f-fill
    @extend .f-box
    @extend .f-dir--col
    @extend .f-align--13-13
    @extend .f-option--safari-basis-fix


  &--child-fill
    &>*
      @extend .f-fill
